<template>
  <div class="card">
    <div class="card-header">
      <template v-if="chartTitleData.isTitleIconUsed">
        <i :class="chartTitleData.TitleIconClass" />
      </template>
      {{ chartTitleData.cardTitle }}
      <template v-if="chartTitleData.isDropdownUsed">
        <b-dropdown class="float-right" variant="p-0" right>
          <template slot="button-content">
            {{ chartTitleDownData.dropDownTitle }}
          </template>
          <b-dropdown-item v-for="(opt, idx) in chartTitleDownData.dropDownDataArr"
                           :key="idx"
                           :data="opt"
                           @click="dropdownAction(opt.optionClickMethod, opt)"
          >
            {{ opt.optionTitle }}
          </b-dropdown-item>
        </b-dropdown>
      </template>
    </div>
    <div class="card-body">
      <b-row v-if="chartType === 'Bar'" :col-default-sizer="selectedSizer">
        <b-col :class="selectedColSizeOption.graph">
          <div>
            <bar-chart-ext
              v-if="loaded"
              class="wrapper"
              :sample-use-y-n="sampleUseYN"
              :chart-data="selectedData"
              :options="selectedOption"
            />
          </div>
        </b-col>
        <b-col :class="selectedColSizeOption.legend">
          <chartLegend
            :chart-type="chartType"
            :sample-use-y-n="sampleUseYN"
            :chart-data="selectedData"
            :legend-option="legendOption"
          />
        </b-col>
      </b-row>
      <b-row v-else-if="chartType === 'Line'" :col-default-sizer="selectedSizer">
        <b-col :class="selectedColSizeOption.graph">
          <div>
            <line-chart-ext
              v-if="loaded"
              class="wrapper"
              :sample-use-y-n="sampleUseYN"
              :chart-data="selectedData"
              :options="selectedOption"
            />
          </div>
        </b-col>
        <b-col :class="selectedColSizeOption.legend">
          <chartLegend
            :chart-type="chartType"
            :sample-use-y-n="sampleUseYN"
            :chart-data="selectedData"
            :legend-option="legendOption"
          />
        </b-col>
      </b-row>
      <b-row v-else-if="chartType === 'Pie'" :col-default-sizer="selectedSizer">
        <b-col :class="selectedColSizeOption.graph">
          <pie-chart-ext
            v-if="loaded"
            class="wrapper"
            :sample-use-y-n="sampleUseYN"
            :chart-data="selectedData"
            :options="selectedOption"
          />
        </b-col>
        <b-col :class="selectedColSizeOption.legend">
          <chartLegend
            :chart-type="chartType"
            :sample-use-y-n="sampleUseYN"
            :chart-data="selectedData"
            :legend-option="legendOption"
          />
        </b-col>
      </b-row>
      <b-row v-else-if="chartType === 'Polar'" :col-default-sizer="selectedSizer">
        <b-col :class="selectedColSizeOption.graph">
          <div>
            <polar-chart-ext
              v-if="loaded"
              class="wrapper"
              :sample-use-y-n="sampleUseYN"
              :chart-data="selectedData"
              :options="selectedOption"
            />
          </div>
        </b-col>
        <b-col :class="selectedColSizeOption.legend">
          <chartLegend
            :chart-type="chartType"
            :sample-use-y-n="sampleUseYN"
            :chart-data="selectedData"
            :legend-option="legendOption"
          />
        </b-col>
      </b-row>
      <b-row v-else-if="chartType === 'Radar'" :col-default-sizer="selectedSizer">
        <b-col :class="selectedColSizeOption.graph">
          <div>
            <radar-chart-ext
              v-if="loaded"
              class="wrapper"
              :sample-use-y-n="sampleUseYN"
              :chart-data="selectedData"
              :options="selectedOption"
            />
          </div>
        </b-col>
        <b-col :class="selectedColSizeOption.legend">
          <chartLegend
            :chart-type="chartType"
            :sample-use-y-n="sampleUseYN"
            :chart-data="selectedData"
            :legend-option="legendOption"
          />
        </b-col>
      </b-row>
      <b-row v-else :col-default-sizer="selectedSizer">
        <b-col :class="selectedColSizeOption.graph">
          <div>
            <donut-chart-ext
              v-if="loaded"
              class="wrapper"
              :sample-use-y-n="sampleUseYN"
              :chart-data="selectedData"
              :options="selectedOption"
            />
          </div>
        </b-col>
        <b-col :class="selectedColSizeOption.legend">
          <chartLegend
            :chart-type="chartType"
            :sample-use-y-n="sampleUseYN"
            :chart-data="selectedData"
            :legend-option="legendOption"
          />
        </b-col>
      </b-row>
    </div>
  </div>
</template>
<script>
/*
   * Note: Graph charts types : ['Bar', 'Line','Pie', 'Radar','Polar','Donut']
   * default option is Donut, if chartType hasn't set.
   */
import barChartExt from '@/components/base/charts/BACT_003_EXT_BaseBarChart.vue';
import lineChartExt from '@/components/base/charts/BACT_004_EXT_BaseLineChart.vue';
import pieChartExt from '@/components/base/charts/BACT_005_EXT_BasePieChart.vue';
import donutChartExt from '@/components/base/charts/BACT_006_EXT_BaseDonutChart.vue';
import polarChartExt from '@/components/base/charts/BACT_007_EXT_BasePolarAreaChart.vue';
import radarChartExt from '@/components/base/charts/BACT_008_EXT_BaseRadarChart.vue';
import chartLegend from '@/components/base/charts/BACT_002_BaseChartLegend.vue';
import sampleChart from '@/components/base/charts/sample_data/chart_sample_data';
const defaultCol = {
    Bar: {
        graph: 'col-xs-12 col-sm-12 col-md-6 col-lg-7',
        legend: 'col-xs-12 col-sm-12 col-md-6 col-lg-5'
    },
    Line: {
        graph: 'col-xs-12 col-sm-12 col-md-6 col-lg-8',
        legend: 'col-xs-12 col-sm-12 col-md-6 col-lg-4'
    },
    Pie: {
        graph: 'col-xs-12 col-sm-12 col-md-6 col-lg-5',
        legend: 'col-xs-12 col-sm-12 col-md-6 col-lg-7'
    },
    Radar: {
        graph: 'col-xs-12 col-sm-12 col-md-6 col-lg-5',
        legend: 'col-xs-12 col-sm-12 col-md-6 col-lg-7'
    },
    Polar: {
        graph: 'col-xs-12 col-sm-12 col-md-6 col-lg-6',
        legend: 'col-xs-12 col-sm-12 col-md-6 col-lg-6'
    },
    Donut: {
        graph: 'col-xs-12 col-sm-12 col-md-6 col-lg-6',
        legend: 'col-xs-12 col-sm-12 col-md-6 col-lg-6'
    }
};

export default {
    name: 'BaseChart',
    components: {
        barChartExt,
        lineChartExt,
        pieChartExt,
        donutChartExt,
        polarChartExt,
        radarChartExt,
        chartLegend
    },
    props: {
        colDefaultSizer: {
            type: Object,
            required: false,
            default: () => {
            }
        },
        chartTitleData: {
            type: Object,
            required: true,
      // eslint-disable-next-line vue/require-valid-default-prop
            default: {
                isTitleIconUsed: false,
                TitleIconClass: 'fal fa-globe fa-2x',
                cardTitle: 'This is Default Title',
                isDropdownUsed: false
            }
        },
        chartTitleDownData: {
            type: Object,
            required: false,
            default: () => ({
                dropDownTitle: 'Sample Title',
                dropDownDataArr: [{ optionId: 'id1', optionTitle: 'sample title1', optionClickMethod: 'optionAction1' },
                    { optionId: 'id2', optionTitle: 'sample title2', optionClickMethod: 'optionAction2' }
                ]
            })
        },
        chartType: {
            type: String,
            default: 'Bar'
        },
        chartData: {
            type: Object,
            default: null,
            required: true
        },
        options: {
            type: Object,
            default: null,
            required: true
        },
        legendOption: {
            type: Number,
            default: 0
        },
        loaded: {
            type: Boolean,
            default: true
        },
        sampleUseYN: {
            type: Boolean,
            default: false
        }
    },
    data () {
        let typeOfChart = this.chartType;
        typeOfChart = ['Bar', 'Line', 'Pie', 'Radar', 'Polar', 'Donut'].includes(this.chartType) ? this.chartType : 'Donut';
        return {
            selectedSizer: this.colDefaultSizer,
            selectedData: this.chartData,
            selectedOption: this.options,
            selectedColSizeOption: defaultCol[typeOfChart]
        };
    },
    created () {
    /* SAMPLE_USE_YN:
       * This is a flag whether Use Sample Data
       */
        if (this.sampleUseYN) {
            const sampleData = this.getSampleData();
            this.selectedData = sampleData[0];
            this.selectedOption = sampleData[1];
            this.consoleLogEnv('legendOption', this.legendOption);
        }

    /* LEGEND_OPTION:
       * Note: when flag == 0, No legend for charts.
       */
        if (this.legendOption == 0) {
            this.selectedColSizeOption = {
                graph: 'col-xs-12 col-sm-12 col-md-12 col-lg-12',
                legend: 'col-xs-0 col-sm-0 col-md-0 col-lg-0'
            };
        } else if (!this.isEmpty(this.colDefaultSizer)) {
            this.selectedColSizeOption = this.colDefaultSizer;
        }
    },
    methods: {
        getSampleData () {
            let returnVal = null;
            if (this.chartType === 'Bar') {
                returnVal = sampleChart.barChartSample();
            } else if (this.chartType === 'Line') {
                returnVal = sampleChart.lineChartSample();
            } else if (this.chartType === 'Pie') {
                returnVal = sampleChart.pieChartSample();
            } else if (this.chartType === 'Polar') {
                returnVal = sampleChart.polarAreaChartSample();
            } else if (this.chartType === 'Radar') {
                returnVal = sampleChart.radarChartSample();
            } else {
                returnVal = sampleChart.donutChartSample();
            }
            return returnVal;
        },
        dropdownAction (emitFunction, item) {
            this.$emit(emitFunction, item);
        },
        getDataLength (chartData) {
            let dataSet = chartData.datasets;
            return (Array.isArray(dataSet)) ? dataSet[0].data.length : dataSet.data.length;
        }

    }
};
</script>

<style lang="scss" scoped>
  .wrapper {
    position: relative;
    max-height: 500px;
    height: 40%;
    width: 100%;
  }
</style>
