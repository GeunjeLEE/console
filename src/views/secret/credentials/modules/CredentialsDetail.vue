<template>
    <div>
        <p-panel-top>Base Information</p-panel-top>
        <p-dynamic-view name="Base Information" view_type="item" :data="item||{}"
                        :data_source="baseDataSource"
        />
        <p-dict-panel :dict.sync="tagsApi.ts.syncState.dict"
                      :edit-mode.sync="tagsApi.ts.syncState.editMode"
                      v-on="tagsApi.ts.listeners"
        />
    </div>
</template>

<script>
/* eslint-disable camelcase */

import { watch } from '@vue/composition-api';
import { DictPanelAPI } from '@/lib/api/dict';
import { fluentApi } from '@/lib/fluent-api';
import PDictPanel from '@/components/organisms/panels/dict-panel/DictPanel.vue';
import PDynamicView from '@/components/organisms/dynamic-view/dynamic-view/DynamicView.vue';
import PPanelTop from '@/components/molecules/panel/panel-top/PanelTop.vue';

export default {
    name: 'PCredentialsDetail',
    components: {
        PDictPanel, PDynamicView, PPanelTop,
    },
    props: {
        item: {
            type: Object,
            default: () => {},
        },
        // todo: need confirm that this is good way - sinsky
        tagConfirmEvent: String,
        tagResetEvent: String,
    },
    setup(props, { parent }) {
        const baseDataSource = [
            { name: 'ID', key: 'secret_id' },
            { name: 'Name', key: 'name' },
            { name: 'Secret Type', key: 'secret_type' },
            {
                name: 'Created at',
                key: 'created_at.seconds',
                view_type: 'datetime',
                view_option: {
                    source_type: 'timestamp',
                    source_format: 'seconds',
                },
            },
            // {
            //     name: 'Group',
            //     key: 'secret_groups',
            //     view_type: 'list',
            //     view_option: {
            //         sub_key: 'name',
            //         delimiter: ' ',
            //         item: {
            //             view_type: 'badge',
            //             view_option: {
            //                 text_color: '#222532',
            //                 background_color: '#DCDDE2',
            //             },
            //         },
            //     },
            // },
        ];

        const tagsApi = new DictPanelAPI(fluentApi.secret().secret());

        watch(() => props.item, async (item) => {
            tagsApi.setId(item.secret_id);
            tagsApi.ts.toReadMode();
            await tagsApi.getData();
        });

        return {
            baseDataSource,
            tagsApi,
        };
    },
};
</script>
